<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>JWT Аутентификация</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <!DOCTYPE html>
  <html lang="ru">

  <head>
    <meta charset="UTF-8">
    <title>JWT Аутентификация</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <style>
      body {
        background-color: #f8f9fa;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .container {
        max-width: 400px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
      }

      h2 {
        text-align: center;
        margin-bottom: 20px;
      }

      .alert {
        margin-top: 10px;
      }

      .btn {
        border-radius: 20px;
      }
    </style>
  </head>

<body>
  <div class="container">
    <h2>Регистрация</h2>
    <div class="mb-3">
      <input id="regName" class="form-control" placeholder="Имя">
    </div>
    <div class="mb-3">
      <input id="regEmail" class="form-control" placeholder="Email">
    </div>
    <div class="mb-3">
      <input id="regPassword" class="form-control" placeholder="Пароль" type="password">
    </div>
    <button class="btn btn-primary w-100" onclick="register()">Зарегистрироваться</button>

    <h2 class="mt-4">Авторизация</h2>
    <div class="mb-3">
      <input id="loginEmail" class="form-control" placeholder="Email">
    </div>
    <div class="mb-3">
      <input id="loginPassword" class="form-control" placeholder="Пароль" type="password">
    </div>
    <button class="btn btn-success w-100" onclick="login()">Войти</button>

    <h2 class="mt-4">Защищенные данные</h2>
    <button class="btn btn-info w-100" onclick="getProtectedData()">Получить данные</button>
    <div id="data" class="mt-3"></div>
    <div id="alertContainer"></div>
  </div>
</body>

</html>


<script>
  // Функция вывода красивых сообщений
  function showAlert(message, success = true) {
    const alertType = success ? 'alert-success' : 'alert-danger';
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert ${alertType}`;
    alertDiv.innerText = message;
    const alertContainer = document.getElementById('alertContainer');
    alertContainer.innerHTML = '';
    alertContainer.appendChild(alertDiv);
    setTimeout(() => alertDiv.remove(), 3000);
  }

  // Регистрация
  async function register() {
    try {
      const response = await fetch('http://localhost:3000/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name: document.getElementById('regName').value,
          email: document.getElementById('regEmail').value,
          password: document.getElementById('regPassword').value
        })
      });

      const data = await response.json();
      showAlert(data.message, response.ok);
    } catch (error) {
      showAlert('Ошибка регистрации: ' + error.message, false);
    }
  }

  // Авторизация
  async function login() {
    try {
      const response = await fetch('http://localhost:3000/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          email: document.getElementById('loginEmail').value,
          password: document.getElementById('loginPassword').value
        })
      });

      const data = await response.json();
      if (!response.ok) throw new Error(data.message);

      // Сохранение токена в localStorage
      localStorage.setItem('token', data.token);
      showAlert('Вход выполнен успешно!', true);
    } catch (error) {
      showAlert('Ошибка входа: ' + error.message, false);
    }
  }

  // Получение защищённых данных
  async function getProtectedData() {
    const token = localStorage.getItem('token');
    if (!token) {
      showAlert('Требуется авторизация', false);
      return;
    }

    try {
      const response = await fetch('http://localhost:3000/api/protected', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        }
      });

      const data = await response.json();
      if (!response.ok) throw new Error(data.message);

      document.getElementById('data').innerHTML = `
          <p><strong>Сообщение:</strong> ${data.message}</p>
          <p><strong>Время:</strong> ${new Date(data.secretData.timestamp).toLocaleString()}</p>
          <p><strong>ID пользователя:</strong> ${data.user.id}</p>
          <p><strong>Пользователь:</strong> ${data.user.email}</p>
          <p><strong>Информация:</strong> ${data.secretData.info}</p>
        `;
    } catch (error) {
      showAlert('Ошибка получения защищённых данных: ' + error.message, false);
    }
  }
</script>
</body>

</html>